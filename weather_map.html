<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        #card-body {
            display: flex;
            justify-content: center;
        }

        .jumbotron {
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body class="container container-fluid">
    <div class="jumbotron jumbotron-fluid">
        <h1>Weather Application</h1>
    </div>
    <div>
        <h3>San Antonio</h3>
    </div>

    <div id="test"></div>
    <div id="card-body">
    </div>

    <div id='map' style='width: 100%; height: 500px;'></div>
    <pre id='coordinates' class='coordinates'></pre>

<script src="js/jquery-2.2.4.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="js/keys.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.1/mapbox-gl.js'></script>
    <script src="js/mapbox-utils.js"></script>




<script>
    $(document).ready(function() {

        //Creates Map and Centers it on San Antonio

        mapboxgl.accessToken = mapboxToken;
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v9',
            zoom: 9,
            center: [-98.4936, 29.4241]
        }); //mapboxgl object

        var marker = new mapboxgl.Marker({
            draggable: true
        }) //marker object
            .setLngLat([-98.4936, 29.4241])
            .addTo(map);

        function onDragEnd() {
            return lngLat = marker.getLngLat();
        } //onDragEnd()

        var coordinates = onDragEnd();

        var longitude = coordinates.lng.toString();

        console.log(longitude);



        var latitude = coordinates.lat.toString();

        console.log(latitude);
        marker.on('dragend', onDragEnd);
        //WEATHER OBJECTS

        var weatherObjects = [
            {
                condition: "clear-day",
                url: 'icon/sun.svg'

            }, {
                condition: "clear-night",
                url: 'icon/moon-full.svg'
            }, {
                condition: "rain",
                url: 'icon/cloud-rain.svg'
            }, {
                condition: "snow",
                url: 'icon/cloud-snow'

            }, {
                condition: "sleet",
                url: 'icon/cloud-hail.svg'
            }, {
                condition: "wind",
                url: 'icon/wind.svg'
            }, {
                condition: "fog",
                url: 'icon/cloud-fog.svg'
            }, {
                condition: "cloudy",
                url: 'icon/cloud.svg'
            }, {
                condition: "partly-cloudy-day",
                url: 'icon/cloud-sun.svg'
            }, {
                condition: "partly-cloudy-night",
                url: 'icon/cloud-moon.svg'
            }
        ];
        //---------------------------------------------------------------------------------------------------------

            //UPDATES WEATHER CARDS

            function makeWeatherCard() {

                var html = "";

                //USER SUBMITTED DATA THROUGH SELECT INPUT
                var days = 3 - 1;

                $.get("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkyKey + "/" + latitude + ", " + longitude).done(function(data) {

                    console.log(data);

                    for(var i = 0; i <= days; i++) {

                            var weatherCondition = "";

                            //Stores the icon string value into this variable

                            var weatherIcon = data.daily.data[i].icon;

                            //Cycles through the weatherObjects array

                            weatherObjects.forEach(function(element) {

                                //check to see if the icon string value is found in the weatherObjects array

                                if(weatherIcon === element.condition) {

                                    //Puts the url for the correct image into the weatherCondition variable

                                    weatherCondition += element.url;

                                } //if

                            }); //forEach()

                            //Converts windSpeed from meters per second to miles per hour

                            var windSpeed = (data.daily.data[i].windSpeed) * 2.237;

                            //Converts time property value to readable time

                            var dateObject = new Date((data.daily.data[i].time) * 1000);

                            html += "<div class=\"card m-5\" style=\"width: 18rem;\">";

                            html += "<div class=\"card-body\">";

                            html += "<h5 class=\"card-title\">" + dateObject + "</h5>";

                            html += "<h6 class=\"card-subtitle mb-2 text-muted\">" + data.daily.data[i].apparentTemperatureHigh + " / " + data.daily.data[i].apparentTemperatureLow + "&#8457;" + "</h6>";

                            html += "<img src=" + weatherCondition + ">";

                            html += "<p class=\"card-text\">" + data.daily.data[i].summary + "</p>";

                            html += "<p class=\"card-text\">" + windSpeed.toFixed(2) + " mph" + "</p>";

                            html += "</div>";

                            html += "</div>";

                    } //if

                    $('#card-body').html(html);

                }); //get()

            } //makeWeatherCard()

            makeWeatherCard();

            //------------------------------------------------------------------------------------------------------



    });//ready()
</script>
</body>
</html>